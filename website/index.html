<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="styles/main.css">
    <title> LEGO MOSAIC MAKER </Title>
    <script src='colorConversions.js'></script>
    <script src='legoMosaicMaker.js'></script>
  </head>

  <body class="content">
    <!--
      I am very clearly a novice web developer. I have been sticking to the pure
      web APIs as much as I can, in order to learn the absolute basics. I am SURE that
      there are better ways to do things here. If you have the motivation to help me
      out, create an issue here https://github.com/jeremyvoldeng/legoMosaicMaker/issues

      Jeremy Voldeng had this great idea and created the first implementation, written
      in Python. I am here to just get it out onto the web.

      Axel!
    -->
    <div class="homeheader">
      <h2 class="titleCard name">
        LEGO MOSAIC MAKER
      </h2>
    </div>

    <div class="lego-zone" id="da-zone">

      <!-- Inputs -->
      <div class="col-cls">
        <input type="file" id="albumArtIn" type="image/*"> </input>

        <div class="col-cls">
          <div class="row-cls">
            <input type="checkbox" id="useLAB"> use LAB color scheme </input>
          </div>
          <button id="reset">Reset image</input>
        </div>

        <div class="slidecontainer row-cls">
          <div class="col-cls">
            <b>Saturation</b>
            <b>Brightness</b>
            <b>Sharpness</b>
          </div>
          <div class="col-cls">
            <input type="range" min="1" max="100" value="1" class="slider" id="saturation">
            <input type="range" min="1" max="100" value="1" class="slider" id="brightness">
            <input type="range" min="1" max="100" value="1" class="slider" id="sharpness">
          </div>
        </div>

      </div>

      <!-- Some nice looking images -->
      <div class="row-cls">
        <canvas id="cvs">
          Sorry, your browser does not support "canvas" elements - this is typically because
          the browser is relatively old. You can try updating your browser, or view the project
          <a href="https://github.com/jeremyvoldeng/legoMosaicMaker">here!</a> Sorry about that.
        </canvas>
        <canvas id="outcvs">
          Sorry, your browser does not support "canvas" elements - this is typically because
          the browser is relatively old. You can try updating your browser, or view the project
          <a href="https://github.com/jeremyvoldeng/legoMosaicMaker">here!</a> Sorry about that.
        </canvas>
      </div>
    </div>
  </body>

  <script>
    const fileSelection = document.getElementById("albumArtIn")
    const resetButton   = document.getElementById("reset")
    const useLABCheck   = document.getElementById("useLAB")

    fileSelection.addEventListener("change", handleFiles)
    resetButton.addEventListener("click", reset)
    useLABCheck.addEventListener("click", legoify)

    const canvas = document.getElementById("cvs")
    const output_canvas = document.getElementById("outcvs")

    const ctx = canvas.getContext('2d')
    const out_ctx = output_canvas.getContext('2d')

    let L;

    function handleFiles() {
          const album_art = this.files[0]
          const album_art_url = URL.createObjectURL(album_art)
          const album_art_img = new Image

          album_art_img.onload = (img) => {
                canvas.width = album_art_img.width
                canvas.height = album_art_img.height
                ctx.drawImage(album_art_img, 0, 0)

                L = new Legoificator(album_art_img)

                const useLAB = useLABCheck.checked
                L.commence_legoification(ctx, out_ctx, useLAB)
                console.log(L)
                L.commence_legoification(ctx, out_ctx, useLAB)
              }
          album_art_img.src = album_art_url
        }

    function reset() {
          console.log(L)
          if (L) 
            L.resizeImage()
        }

    function legoify() {
          console.log(L)
          if (L) {
                // for some reason, when this func is called, L gets assigned
                // a value of 94ish. Why?!
                console.log(useLABCheck.checked)
                L.commence_legoification(ctx, out_ctx, useLABCheck.checked)
              }
          console.log(L)
        }
  </script>
</html>
